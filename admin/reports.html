<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Admin — Signalements</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
<h1>Signalements</h1>
<div id="list">Chargement…</div>

<script type="module">
  import { db } from "../_shared/firebase.js";
  import { requireModeration } from "../_shared/guard.js";
  import {
    collection, getDocs, doc, updateDoc
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const list = document.getElementById("list");

  async function load(){
    const snap = await getDocs(collection(db,"reports"));
    list.innerHTML="";
    snap.forEach(d=>{
      const r=d.data();
      const div=document.createElement("div");
      div.innerHTML=`${r.reason || "—"} <button>Clore</button>`;
      div.querySelector("button").onclick=()=>updateDoc(doc(db,"reports",d.id),{status:"closed"}).then(load);
      list.appendChild(div);
    });
  }

  requireModeration({ redirectTo:"../index.html", onOk:load });
</script>

<script type="module" src="../auth/status.js"></script>
</body>
</html>
