<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Admin â€” Notes</title>
</head>
<body>
<h1>Notes annonces</h1>
<div id="list"></div>

<script type="module">
  import { db } from "../_shared/firebase.js";
  import { requireAdmin } from "../_shared/guard.js";
  import {
    collection,getDocs,doc,updateDoc
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const list=document.getElementById("list");

  async function load(){
    const snap=await getDocs(collection(db,"annonces_location"));
    list.innerHTML="";
    snap.forEach(d=>{
      const a=d.data();
      const div=document.createElement("div");
      div.innerHTML=`${a.titre||"Annonce"} (${a.ratingAvg||0}) <button>Reset</button>`;
      div.querySelector("button").onclick=()=>updateDoc(doc(db,"annonces_location",d.id),{ratingAvg:0,ratingCount:0});
      list.appendChild(div);
    });
  }

  requireAdmin({redirectTo:"../index.html",onOk:load});
</script>
</body>
</html>
