<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Admin â€” Utilisateurs</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>

<header class="topbar">
  <div class="container topbar-row">
    <div>
      <h1>WAUKLINK</h1>
      <div class="subtitle">Admin â€” Utilisateurs</div>
    </div>
    <nav class="topbar-nav">
      <a class="btn" href="./index.html">â† Dashboard</a>
    </nav>
  </div>
</header>

<main class="container main-layout">
  <h2>ğŸ‘¥ Tous les utilisateurs</h2>
  <p id="msg" class="meta">Chargementâ€¦</p>
  <section id="list" class="grid"></section>
</main>

<footer class="footer">
  <div class="container footer-row">
    <span>Â© WAUKLINK</span>
  </div>
</footer>

<script type="module">
  import { db } from "../shared/firebase.js";
  import { requireAdmin } from "../shared/guard.js";
  import { collection, getDocs } from
    "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const list = document.getElementById("list");
  const msg  = document.getElementById("msg");

  async function loadUsers() {
    list.innerHTML = "";
    const snap = await getDocs(collection(db, "users"));

    if (snap.empty) {
      msg.textContent = "Aucun utilisateur";
      return;
    }

    msg.textContent = `${snap.size} utilisateur(s)`;

    snap.forEach(d => {
      const u = d.data();

      let badge = "âšª User";
      if (u.role === "admin") badge = "ğŸ‘‘ Admin";
      else if (u.isPro === true) badge = "ğŸŸ¢ PRO";

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <strong>${u.firstName || "â€”"}</strong>
        <div class="meta">${u.email || ""}</div>
        <div class="meta">${badge}</div>
      `;
      list.appendChild(card);
    });
  }

  requireAdmin({
    onOk: loadUsers,
    onDenied: () => {
      msg.textContent = "AccÃ¨s rÃ©servÃ© aux administrateurs";
    }
  });
</script>

</body>
</html>
