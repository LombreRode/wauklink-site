<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Locations</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../style.css">
</head>
<body>

<h1>Locations</h1>
<div id="list">Chargement…</div>

<script type="module">
  import { db } from "../_shared/firebase.js";
  import {
    collection, query, where, getDocs
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const list=document.getElementById("list");
  const duree=new URLSearchParams(location.search).get("duree");

  async function load(){
    let q = collection(db,"annonces_location");
    let conditions = [ where("status","==","active") ];

    if (duree){
      conditions.push(where("duree","==",duree));
    }

    const snap = await getDocs(query(q,...conditions));
    list.innerHTML="";

    if (snap.empty){
      list.textContent="Aucune annonce.";
      return;
    }

    snap.forEach(d=>{
      const a=d.data();
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <h3>${a.titre}</h3>
        <p>${a.ville}</p>
        <p>${a.prix} €</p>
        <small>${a.duree}</small>
      `;
      list.appendChild(div);
    });
  }

  load();
</script>

<script type="module" src="../auth/status.js"></script>
</body>
</html>
