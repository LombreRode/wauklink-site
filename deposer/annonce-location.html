<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>D√©poser une annonce ‚Äî WAUKLINK</title>

  <!-- STYLE GLOBAL -->
  <link rel="stylesheet" href="../style.css">
</head>

<body>
<header class="topbar">
  <div class="container topbar-row">
    <div>
      <h1>WAUKLINK</h1>
      <div class="subtitle">D√©poser une annonce</div>
    </div>
    <nav class="topbar-nav">
      <a class="btn" href="../dashboard/index.html">‚Üê Tableau de bord</a>
    </nav>
  </div>
</header>

<main class="container main-layout">
  <section class="card" style="max-width:700px;margin:0 auto">
    <h2>Nouvelle annonce</h2>

    <form id="form" class="form-column">
      <label>
        Titre
        <input type="text" id="titre" required>
      </label>

      <label>
        Ville
        <input type="text" id="ville" required>
      </label>

      <label>
        Type
        <select id="type" required>
          <option value="">Choisir</option>
          <option value="location">Location</option>
          <option value="service">Service</option>
        </select>
      </label>

      <label>
        Prix (‚Ç¨)
        <input type="number" id="prix" min="0">
      </label>

      <label>
        Description
        <textarea id="description" rows="5" required></textarea>
      </label>

      <button type="submit" class="btn btn-ok">
        Publier l‚Äôannonce
      </button>
    </form>

    <p id="msg" class="meta" aria-live="polite"></p>
  </section>
</main>

<footer class="footer">
  <div class="container footer-row">
    <span>¬© WAUKLINK</span>
    <nav class="footer-nav">
      <a class="link" href="../pricing.html">Tarifs</a>
      <a class="link" href="../legal/index.html">CGU</a>
      <a class="link" href="../legal/privacy.html">Confidentialit√©</a>
      <a class="link" href="../legal/mentions-legales.html">Mentions l√©gales</a>
    </nav>
  </div>
</footer>

<!-- üîê AUTH -->
<script type="module">
  import { auth, db } from "../shared/firebase.js";
  import { onAuthStateChanged } from
    "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import {
    collection, addDoc, serverTimestamp
  } from
    "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const form = document.getElementById("form");
  const msg  = document.getElementById("msg");

  onAuthStateChanged(auth, (user) => {
    if (!user) {
      location.replace("../auth/login.html");
    }
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = {
      titre: document.getElementById("titre").value.trim(),
      ville: document.getElementById("ville").value.trim(),
      type: document.getElementById("type").value,
      prix: Number(document.getElementById("prix").value || 0),
      description: document.getElementById("description").value.trim(),
      status: "pending",
      createdAt: serverTimestamp(),
      ownerUid: auth.currentUser.uid
    };

    if (!data.titre || !data.ville || !data.type || !data.description) {
      msg.textContent = "‚ùå Tous les champs obligatoires doivent √™tre remplis";
      return;
    }

    msg.textContent = "‚è≥ Publication en cours‚Ä¶";

    try {
      await addDoc(collection(db, "annonces_location"), data);
      msg.textContent = "‚úÖ Annonce envoy√©e pour validation";
      form.reset();
    } catch (err) {
      console.error(err);
      msg.textContent = "‚ùå Erreur lors de la publication";
    }
  });
</script>

</body>
</html>
