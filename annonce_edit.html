<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WAUKLINK ‚Äî Modifier les photos</title>
  <link rel="stylesheet" href="/wauklink-site/style.css" />
</head>

<body class="page-edit-photos">

<header class="topbar">
  <div class="container topbar-row">
    <div>
      <h1>WAUKLINK</h1>
      <div class="subtitle">Modifier les photos</div>
    </div>
    <nav>
      <a class="btn" href="/wauklink-site/index.html">‚Üê Accueil</a>
    </nav>
  </div>
</header>

<main class="container wrap">
  <div class="card edit-photos-card">
    <h2>Photos de l‚Äôannonce</h2>

    <p class="meta">
      ‚úî Maximum 6 photos<br>
      ‚úî Visible seulement si annonce <b>ACTIVE</b>
    </p>

    <input
      id="photosInput"
      type="file"
      accept="image/*"
      multiple
    />

    <div id="preview" class="thumbs"></div>
    <div id="msg" class="meta"></div>

    <div class="actions">
      <button class="btn" onclick="history.back()">Annuler</button>
      <button id="saveBtn" class="btn">üíæ Enregistrer</button>
    </div>
  </div>
</main>

<!-- AUTH GLOBAL -->
<script type="module" src="/wauklink-site/auth/status.js"></script>
<script type="module" src="/wauklink-site/auth/user_sync.js"></script>

<!-- GUARD OWNER + ACTIVE (JS M√âTIER √Ä AJOUTER ENSUITE) -->
<script type="module">
  import { auth, db } from "/wauklink-site/shared/firebase.js";
  import { onAuthStateChanged } from
    "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import { doc, getDoc } from
    "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const params = new URLSearchParams(location.search);
  const annonceId = params.get("id");
  const msg = document.getElementById("msg");

  onAuthStateChanged(auth, async (user) => {
    if (!user || !annonceId) {
      location.replace("/wauklink-site/auth/login.html");
      return;
    }

    const snap = await getDoc(doc(db, "annonces_location", annonceId));
    if (!snap.exists()) {
      msg.textContent = "‚ùå Annonce introuvable";
      return;
    }

    const a = snap.data();
    const owner = a.ownerUid || a.ownerId;

    if (a.status !== "active" || owner !== user.uid) {
      msg.textContent = "‚õî Acc√®s interdit";
      return;
    }

    msg.textContent = "‚úî Acc√®s autoris√©";
  });
</script>

</body>
</html>
